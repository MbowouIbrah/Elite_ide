{% load static %}

<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Détails des Formations - Prépa Concours IDE</title>
    <link rel="stylesheet" href="{% static 'css/dash.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
</head>
<body>
    <header>
        <nav>
            <a href="#">
                <img src="{% static 'images/logo.png' %}" alt="Logo Prépa Concours IDE" style="max-width: 120px;">
            </a>
            <div class="menu">
                <ul>
                    <li><a href="">Dashboard</a></li>
                    <li class="has-submenu">Formations
                        <ul class="submenu">
                            <li><a href="{% url 'formation' %}">Infirmiers</a></li>
                            <li><a href="{% url 'formation' %}">Technicien de labo</a></li>
                            <li><a href="{% url 'formation' %}">Aide-Soignants</a></li>
                            <li><a href="{% url 'formation' %}">Sage-Femme</a></li>
                            <li><a href="{% url 'formation' %}">Aide Tech. de labo</a></li>
                        </ul>
                    </li>
                    <li><a href="{% url 'informations' %}">Informations</a></li>
                    <li><a href="#">À propos</a></li>
                </ul>
            </div>

            <div class="compte">
                {% if user.is_authenticated %}
                    <div class="user-avatar" onclick="toggleModal()">
                        {{ user.username|slice:":1" | upper }}
                    </div>
                    <div id="user-modal" class="user-modal hidden">
                        <div class="user-option">
                            <i class="fas fa-user"></i>
                            <p>{{ user.username }}</p>
                        </div>

                        <div class="user-option">
                            <i class="fas fa-wallet"></i>
                            <a href="#">Payer une formation</a>
                        </div>

                        <div class="user-option">
                            <i class="fas fa-sign-out-alt"></i>
                            <a href="{% url 'deconnexion' %}">Déconnexion</a>
                        </div>
                    </div>
                {% else %}
                    <a href="{% url 'connexion' %}">
                        <button class="connexion">Connexion</button>
                    </a>
                    <a href="{% url 'inscription' %}">
                        <button class="inscription">Créer compte</button>
                    </a>
                {% endif %}
            </div>
        </nav>
    </header>


    <div class="container">
        <aside class="sidebar">
            <ul>
                <div class="user-info">
                    <img src="{% static 'images/user.png' %}" alt="Photo de profil" class="user-avatar" />
                    <div class="user-details">
                        <strong>{{ user.username }}</strong>
                        
                        {% if role == 1%}
                
                            <p>Formateur</p>
            
                        {% elif role == 2%}

                            <p>Promoteur</p>

                        {% elif role == 3%}

                            <p>Administrateur</p>

                        {% endif %}
                    </div>
                </div>

                {% if role == 1 %}
                
                    <li onclick="showSection('Candidats')">Candidats</li>
                    <li onclick="showSection('Examens')">Examens</li>
            
                {% elif role == 2 %}

                    <li onclick="showSection('Formateurs')">Formateurs</li>
                    <li onclick="showSection('Formations')">Formations</li>
                    <li onclick="showSection('Paiements')">Paiements</li>

                {% elif role == 3 %}
                
                    <li onclick="showSection('Candidats')">Candidats</li>
                    <li onclick="showSection('Formateurs')">Formateurs</li>
                    <li onclick="showSection('Promoteur')">Promoteur</li>
                
                {% endif %}
                
                <li onclick="showSection('')">Messages</li>

            </ul>
        </aside>
    
        <main id="main-content">
            <!-- Section Candidats -->
            <div class="Candidats section">
                <h2>
                    Liste des Candidats
                    <i class="fas fa-plus-circle add-icon" title="Ajouter un candidat" onclick="openModal()"></i>
                </h2>

                <div class="card-grid">
                    {% if candidats %}
                        {% for candidat in candidats %}
                            <div class="card">
                                <h3>{{ candidat.first_name }} {{ candidat.last_name }}</h3>  <!-- Affiche le nom du candidat -->
                                <p>Email: {{ candidat.email }}</p>  <!-- Affiche l'email du candidat -->

                                <div class="card-actions">
                                    <i class="fas fa-info-circle" title="Informations"></i>
                                    <i class="fas fa-user-slash" title="Suspendre"></i>
                                    <i class="fas fa-trash-alt" title="Supprimer"></i>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p>Aucun candidat trouvé.</p>  <!-- Message si aucun candidat n'est disponible -->
                    {% endif %}
                </div>
            </div>

    
            <!-- Section Examens -->
            <div class="Examens section" style="display: none;">
                <h2>
                    Liste des Examens
                    <i class="fas fa-plus-circle add-icon" title="Ajouter un examen" onclick="openModal('examen-modal')"></i>
                </h2>
                <div class="examens-list">
                    {% for examen in examens %}
                        <div class="examen-card">
                            <h3>{{ examen.nom }}</h3>
                            <p>Date : {{ examen.date }}</p>
                            <p>Formation : {{ examen.formation.titre }}</p>
                            <div class="examen-actions">
                                <i class="fas fa-edit action-icon" title="Modifier"></i>
                                <i class="fas fa-trash action-icon" title="Supprimer"></i>
                                <i class="fas fa-info-circle action-icon" title="Détails"></i>
                            </div>
                        </div>
                    {% empty %}
                        <p>Aucun examen disponible.</p>
                    {% endfor %}
                </div>
            </div>

    
            <!-- Section Formateurs -->
            <div class="Formateurs section" style="display: none;">
                <h2>
                    Liste des Formateurs
                    <i class="fas fa-plus-circle add-icon" title="Ajouter un formateur" onclick="openModal('formateur-modal')"></i>
                </h2>
                <div class="card-grid">
                    {% for formateur in formateurs %}
                        <div class="card">
                            <h3>{{ formateur.first_name }} {{ formateur.last_name }}</h3>
                            <p>Formations: 
                                {% for formation in formateur.formations.all %}
                                    {{ formation.titre }}{% if not forloop.last %}, {% endif %}
                                {% empty %}
                                    Aucune formation associée
                                {% endfor %}
                            </p>
                            <div class="card-actions">
                                <i class="fas fa-info-circle" title="Informations"></i>
                                <i class="fas fa-user-slash" title="Suspendre"></i>
                                <i class="fas fa-trash-alt" title="Supprimer"></i>
                            </div>
                        </div>
                    {% empty %}
                        <p>Aucun formateur disponible.</p>
                    {% endfor %}
                </div>
            </div>




            <!-- Section Formations -->
        <!-- Section Formations -->
<div class="Formations section" style="display: none;">
    <h2>
        Liste des Formations
        <i class="fas fa-plus-circle add-icon" title="Ajouter une formation" onclick="openModal('formation-modal')"></i>
    </h2>
    <div class="card-grid">
        {% for formation in formations %}
        <div class="card">
            <h3>{{ formation.titre }}</h3>
            <p>Prix: {{ formation.prix }}</p>
            <div class="card-actions">
                <i class="fas fa-info-circle" title="Informations"></i>
                <i class="fas fa-edit" title="Modifier"></i>
                <i class="fas fa-trash-alt" title="Supprimer"></i>
            </div>
        </div>
        {% empty %}
            <p>Aucune formation disponible.</p>
        {% endfor %}
    </div>
</div>
 




    
            <!-- Section Paiements -->
            <div class="Paiements section" style="display: none;">
                <h2>
                    Liste des Paiements
                    <i class="fas fa-plus-circle add-icon" title="Ajouter un paiement" onclick="openModal()"></i>
                </h2>
                <div class="paiements-list">
                    <div class="paiement-card">
                        <h3>Titre du Paiement</h3>
                        <p>Description du paiement, avec des détails pertinents.</p>
                        <div class="paiement-actions">
                            <i class="fas fa-edit action-icon" title="Modifier"></i>
                            <i class="fas fa-trash action-icon" title="Supprimer"></i>
                            <i class="fas fa-info-circle action-icon" title="Détails"></i>
                        </div>
                    </div>
                    <!-- Autres cartes de paiement -->
                </div>
            </div>



             <!-- Section Promoteur -->
             <div class="Promoteur section">
                <h2>
                    Liste des Promoteurs
                    <i class="fas fa-plus-circle add-icon" title="Ajouter un promoteur" onclick="openModal('promoteur-modal')"></i>
                </h2>
                <div class="card-grid">
                    {% if promoteurs %}
                        {% for promoteurs in promoteurs %}
                            <div class="card">
                                <h3>{{ promoteurs.first_name }} {{ promoteurs.last_name }}</h3>  <!-- Affiche le nom du candidat -->
                                <p>Email: {{ promoteurs.email }}</p>  <!-- Affiche l'email du candidat -->

                                <div class="card-actions">
                                    <i class="fas fa-info-circle" title="Informations"></i>
                                    <i class="fas fa-user-slash" title="Suspendre"></i>
                                    <i class="fas fa-trash-alt" title="Supprimer"></i>
                                </div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p>Aucun promoteurs trouvé.</p>  <!-- Message si aucun candidat n'est disponible -->
                    {% endif %}
                </div>
            </div>


            <!-- Section Messagerie -->
            <div class="Messages section" style="display: none;">
                <h2>
                    Messagerie
                    <i class="fas fa-plus-circle add-icon" title="Ajouter un paiement" onclick="openModal()"></i>
                </h2>
                <div class="paiements-list">
                    <div class="paiement-card">
                        <h3>Titre du Paiement</h3>
                        <p>Description du paiement, avec des détails pertinents.</p>
                        <div class="paiement-actions">
                            <i class="fas fa-edit action-icon" title="Modifier"></i>
                            <i class="fas fa-trash action-icon" title="Supprimer"></i>
                            <i class="fas fa-info-circle action-icon" title="Détails"></i>
                        </div>
                    </div>
                    <!-- Autres cartes de paiement -->
                </div>
            </div>


    
            <!-- Modales -->

            <!-- Modale Promoteur -->
            <div id="promoteur-modal" class="modal">
                <div class="modal-content">
                    <span class="close" onclick="closeModal()">&times;</span>
                    <h2>Ajouter / Modifier un Promoteur</h2>

                    <form id="promoteur-form" method="POST" enctype="multipart/form-data">
                        {% csrf_token %}

                        <div class="form-row">
                            <input type="text" id="first_name" name="first_name" placeholder="Prénom du formateur" required>
                            <input type="text" id="last_name" name="last_name" placeholder="Nom du formateur" required>
                        </div>

                        <div class="form-row">
                            <input type="email" id="email" name="email" placeholder="Email du formateur" required>
                            <input type="text" id="username" name="username" placeholder="Nom d'utilisateur" required>
                        </div>

                        <div class="form-row">
                            <input type="password" id="password1" name="password1" placeholder="Mot de passe" required>
                            <input type="password" id="password2" name="password2" placeholder="Confirmez le mot de passe" required>
                        </div>

                        <div class="form-row">
                            <input type="file" id="formateur-image" name="image" accept="image/*">
                        </div>

                        <button type="submit" class="submit-btn">Enregistrer</button>
                    </form>
                </div>
            </div>




            <!-- Modale Formateur -->
            <div id="formateur-modal" class="modal">
                <div class="modal-content">
                    <span class="close" onclick="closeModal('formateur-modal')">&times;</span>
                    <h2>Ajouter / Modifier un Formateur</h2>

                    <form id="formateur-form" method="POST" enctype="multipart/form-data">
                        {% csrf_token %}

                        <div class="form-row">
                            <input type="text" id="first_name" name="first_name" placeholder="Prénom du formateur" required>
                            <input type="text" id="last_name" name="last_name" placeholder="Nom du formateur" required>
                        </div>

                        <div class="form-row">
                            <input type="email" id="email" name="email" placeholder="Email du formateur" required>
                            <input type="text" id="username" name="username" placeholder="Nom d'utilisateur" required>
                        </div>

                        <div class="form-row">
                            <input type="password" id="password1" name="password1" placeholder="Mot de passe" required>
                            <input type="password" id="password2" name="password2" placeholder="Confirmez le mot de passe" required>
                        </div>

                        <div class="form-row">
                            <input type="file" id="formateur-image" name="image" accept="image/*">
                        </div>

                        <div class="formation-row">
                            <label for="formations">Sélectionnez les formations :</label>
                            {{ formateur_form.formations }}  <!-- Assurez-vous que cela affiche le champ de sélection -->
                            <!-- Si cela ne fonctionne pas, vous pouvez essayer ceci : -->
                            {% for formation in formations %}
                                <input type="checkbox" name="formations" value="{{ formation.id }}">{{ formation.titre }}<br>
                            {% endfor %}
                        </div>
                        <input type="hidden" name="formateur" value="1">


                        <button type="submit" class="submit-btn">Enregistrer</button>
                    </form>
                </div>
            </div>




            <!-- Modale Formation -->
            <div id="formation-modal" class="modal">
                <div class="modal-content">
                    <span class="close" onclick="closeModal('formation-modal')">&times;</span>
                    <h2>Ajouter / Modifier une Formation</h2>

                    <form id="formation-form" method="POST" enctype="multipart/form-data">
                        {% csrf_token %}

                        <div class="form-row-formation">
                            <input type="text" id="titre" name="titre" placeholder="Titre de la formation" required>
                        </div>
                        <div class="form-row-formation">
                            <input type="number" id="prix" name="prix" placeholder="Prix" required>
                        </div>
                        <div class="form-row-formation">
                            <textarea id="description" name="description" placeholder="Description de la formation" required></textarea>
                        </div>
                        <input type="hidden" name="formation" value="1">


                        <button type="submit" class="submit-btn">Enregistrer</button>
                    </form>
                </div>
            </div>


           <!-- Modale Examen -->
            <div id="examen-modal" class="modal">
                <div class="modal-content">
                    <span class="close" onclick="closeModal('examen-modal')">&times;</span>
                    <h2>Ajouter / Modifier un Examen</h2>

                    <form id="examen-form" method="POST" enctype="multipart/form-data">
                        {% csrf_token %}

                        <!-- Affichage des messages d'erreur -->
                        {% if examen_form.errors %}
                            <div class="error-messages">
                                <ul>
                                    {% for field, errors in examen_form.errors.items %}
                                        {% for error in errors %}
                                            <li>{{ error }}</li>
                                        {% endfor %}
                                    {% endfor %}
                                    {% for error in examen_form.non_field_errors %}
                                        <li>{{ error }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        {% endif %}

                        <!-- Étape 1 : Données de l'Examen -->
                        <div id="step-1">
                            <div class="form-row-formation">
                                <input type="text" id="examen_name" name="nom" placeholder="Nom de l'Examen" required>
                            </div>

                            <div class="form-row-formation">
                                <select id="formation_select" class="selectFormation" name="formation" required>
                                    <option value="">Sélectionnez une formation</option>
                                    {% for formation in formations %}
                                        <option value="{{ formation.id }}">{{ formation.titre }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <div class="form-row-formation">
                                <input type="number" id="duration" name="duree" placeholder="Durée (minutes)" required>
                            </div>

                            <div class="form-row-formation">
                                <input type="date" id="exam_date" name="date" required>
                            </div>

                            <!-- Nouveau Champ : Nombre de Questions -->
                            <div class="form-row-formation">
                                <input 
                                    type="number" 
                                    id="nombre_questions" 
                                    name="nombre_questions" 
                                    placeholder="Nombre de Questions" 
                                    min="1" 
                                    required>
                            </div>

                            <button type="button" class="submit-btn" onclick="submitExam()">Enregistrer</button>
                        </div>

                        <!-- Étape 2 : Ajout des Questions et Réponses
                        <div id="step-2" style="display: none;">
                            <div id="question-container"></div>

                            <button type="button" class="question-btn1" onclick="addQuestion()">Ajouter une Question</button>

                            <div class="button-group">
                                <button type="button" class="submit-btn" onclick="previousStep(2)">Précédent</button>
                                <button type="button" class="submit-btn" onclick="submitExam()">Valider</button>
                            </div>
                        </div> -->
                    </form>
                </div>
            </div>





        </main>
    </div>
    
    

    <script>
        // Fonction pour afficher la section sélectionnée
        function showSection(section) {
            // Masquer toutes les sections
            document.querySelectorAll('.section').forEach(el => el.style.display = 'none');
            // Afficher la section spécifiée
            document.querySelector(`.${section}`).style.display = 'block';
        }

        // Fonction pour ouvrir une modal spécifique
        function openModal(name) {
            // Afficher la modal spécifiée
            document.getElementById(name).style.display = 'block';
        }

        // Fonction pour fermer les modals
        function closeModal() {
            // Masquer toutes les modals
            document.getElementById('promoteur-modal').style.display = 'none';
            document.getElementById('formateur-modal').style.display = 'none';
            document.getElementById('formation-modal').style.display = 'none';
        }


        // Récupérer le rôle de l'utilisateur depuis le template Django
        var role = "{{ role }}";

        // Initialiser la session en fonction du rôle de l'utilisateur
        function initSession() {
            if (role === '1') {
                showSection('Candidats'); 
            } else if (role === '2') {
                showSection('Formateurs'); 
            } else if (role === '3') {
                showSection('Promoteur'); 
            }
        }

        // Événement au chargement de la page
        window.onload = initSession;

        // Fonction pour basculer l'affichage du modal utilisateur
        function toggleModal() {
            const modal = document.getElementById('user-modal');
            modal.classList.toggle('visible');
        }

        // Événement pour fermer le modal utilisateur si l'utilisateur clique en dehors
        window.addEventListener('click', function (event) {
            const modal = document.getElementById('user-modal');
            const avatar = document.querySelector('.user-avatar');

            if (!modal.contains(event.target) && event.target !== avatar) {
                modal.classList.remove('visible');
            }
        });


        
        // Fonction pour fermer la modale
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }


        function removeElement(button) {
            button.parentElement.remove();
        }

        function submitExam() {
            document.getElementById('examen-form').submit();
        }


    </script>

    
    
</body>
</html>
